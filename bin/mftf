#!/usr/bin/env php

<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

if (PHP_SAPI !== 'cli') {
    echo 'bin/mftf must be run as a CLI application';
    exit(1);
}

$autoload_path = realpath(__DIR__ . '/../../../autoload.php');
$test_bootstrap_path = realpath(__DIR__ . '/../dev/tests/functional/_bootstrap.php');

if (file_exists($autoload_path)) {
    require_once $autoload_path;
} else {
    require_once $test_bootstrap_path;
}


try {
    $application = new Symfony\Component\Console\Application();
    $application->setName('Magento Functional Testing Framework CLI');
    $application->setVersion('1.0.0');
    $application->add(new Magento\FunctionalTestingFramework\Console\SetupEnvCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\CleanProjectCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\BuildProjectCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\GenerateSuiteCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\GenerateTestsCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\RunTestGroupCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\RunTestCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\GenerateDevUrnCommand());
    $application->add(new Magento\FunctionalTestingFramework\Console\UpgradeTestsCommand());
    $application->run();
} catch (\Exception $e) {
    while ($e) {
        echo $e->getMessage();
        echo $e->getTraceAsString();
        echo "\n\n";
        $e = $e->getPrevious();
    }
    exit(1);
}
